# Book Store Dimensional Modeling

## Enterprise Data Warehouse Bus Matrix
| Business Processes  | Grain                                 | Metrics       | Date | Books | Carrier Services | Customers | Orders | Shipments |
|---------------------|----------------------------------------|---------------|------|-------|------------------|-----------|--------|-----------|
| Book Inventory      | 1 row per book's stock level per day  | Stock count   |  X   |   X   |                  |           |        |           |
| Item Transactions   | 1 row per book in an order            | Sales         |  X   |   X   |                  |     X     |   X    |           |
| Shipment Events     | 1 row per shipment of an order        | Delivery time |  X   |       |        X         |           |   X    |     X     |


## How To Run
Uses UV for package management. Virtual environment setup:
```sh
uv venv
uv sync
.venv/Scripts/activate
```
To run the dbt models and tests:
```sh
dbt build
```

## Documentation
Up to date documentation can be generated by
```sh
dbt docs generate
dbt docs serve
```
## Fact Tables

### `f_book_inventory`
Snapshot fact table capturing the daily state of book inventory, including current unit price and stock levels per day.

### `f_order_item_transactions`
Event-based fact table detailing individual order item transactions. It aligns with SCD dimensions to reflect customer, order, and book attributes at the time of the event.

### `f_shipment_events`
Transactional fact table logging shipment events, including status updates, costs, and delivery timelines. Integrates with SCD2 dimensions for order and carrier context.

## Dimension Tables

### `d_books`
Book dimension storing static book and author data as recorded at the time of book ingestion.

### `d_carriers_services`
Hybrid SCD dimension combining carrier and service data. Uses SCD0 for identifiers, SCD1 for contact details, and SCD2 for price and service validity.

### `d_customers`
Customer dimension with a hybrid SCD approach: Type 0 for IDs, Type 1 for names, and Type 2 for contact/address changes over time.

### `d_orders`
SCD Type 2 dimension capturing historical versions of customer orders, tracking status, shipping methods, and order dates.

### `d_shipments`
Type 1 dimension for shipments, maintaining only the latest state of each shipment record.

## Source: `staging_db`

Unified CDC source capturing transactional changes from `store_db` and `shipping_db` via **Debezium**. Tables contain append-only event streams enriched with metadata for change tracking and replayability.

### Key Features
- **Origin**: Extracted via Debezium from upstream operational databases.
- **CDC Metadata**:
  - `op`: Operation type (`c`, `u`, `d`, `r`)
  - `ts_ms`: Source DB event timestamp
  - `emitted_ts_ms`: Debezium emit time
  - `transaction_id`, `lsn`, `connector_version`: CDC tracing info

### Tables
| Table              | Description |
|--------------------|-------------|
| `authors`          | Book author details (name, bio, country) |
| `books`            | Book catalog incl. author, ISBN, price, genre, stock |
| `customers`        | Customer profiles with contact and address info |
| `orders`           | Orders placed, status, and shipping method |
| `order_items`      | Line items for each order, with quantity and discounts |
| `carriers`         | Shipping carriers (e.g. FedEx, UPS) with contact info |
| `shipping_services`| Carrier service levels and cost estimates |
| `shipments`        | Shipments tied to orders with tracking and delivery info |
| `shipment_events`  | Shipment status history by time and location |
